document.write('<link rel="stylesheet" href="https://gist-assets.github.com/assets/embed-8bf0013c72fb64f0bb1bc1872b43e39e.css">')
document.write('<div id=\"gist5200199\" class=\"gist\">\n        <div class=\"gist-file\">\n          <div class=\"gist-data gist-syntax\">\n            \n\n\n\n    <div class=\"file-data\">\n      <table cellpadding=\"0\" cellspacing=\"0\" class=\"lines highlight\">\n        <tr>\n          <td class=\"line-numbers\">\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L1\" rel=\"file-cortex_hardfault_handler-c-L1\">1<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L2\" rel=\"file-cortex_hardfault_handler-c-L2\">2<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L3\" rel=\"file-cortex_hardfault_handler-c-L3\">3<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L4\" rel=\"file-cortex_hardfault_handler-c-L4\">4<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L5\" rel=\"file-cortex_hardfault_handler-c-L5\">5<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L6\" rel=\"file-cortex_hardfault_handler-c-L6\">6<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L7\" rel=\"file-cortex_hardfault_handler-c-L7\">7<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L8\" rel=\"file-cortex_hardfault_handler-c-L8\">8<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L9\" rel=\"file-cortex_hardfault_handler-c-L9\">9<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L10\" rel=\"file-cortex_hardfault_handler-c-L10\">10<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L11\" rel=\"file-cortex_hardfault_handler-c-L11\">11<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L12\" rel=\"file-cortex_hardfault_handler-c-L12\">12<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L13\" rel=\"file-cortex_hardfault_handler-c-L13\">13<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L14\" rel=\"file-cortex_hardfault_handler-c-L14\">14<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L15\" rel=\"file-cortex_hardfault_handler-c-L15\">15<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L16\" rel=\"file-cortex_hardfault_handler-c-L16\">16<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L17\" rel=\"file-cortex_hardfault_handler-c-L17\">17<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L18\" rel=\"file-cortex_hardfault_handler-c-L18\">18<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L19\" rel=\"file-cortex_hardfault_handler-c-L19\">19<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L20\" rel=\"file-cortex_hardfault_handler-c-L20\">20<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L21\" rel=\"file-cortex_hardfault_handler-c-L21\">21<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L22\" rel=\"file-cortex_hardfault_handler-c-L22\">22<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L23\" rel=\"file-cortex_hardfault_handler-c-L23\">23<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L24\" rel=\"file-cortex_hardfault_handler-c-L24\">24<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L25\" rel=\"file-cortex_hardfault_handler-c-L25\">25<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L26\" rel=\"file-cortex_hardfault_handler-c-L26\">26<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L27\" rel=\"file-cortex_hardfault_handler-c-L27\">27<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L28\" rel=\"file-cortex_hardfault_handler-c-L28\">28<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L29\" rel=\"file-cortex_hardfault_handler-c-L29\">29<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L30\" rel=\"file-cortex_hardfault_handler-c-L30\">30<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L31\" rel=\"file-cortex_hardfault_handler-c-L31\">31<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L32\" rel=\"file-cortex_hardfault_handler-c-L32\">32<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L33\" rel=\"file-cortex_hardfault_handler-c-L33\">33<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L34\" rel=\"file-cortex_hardfault_handler-c-L34\">34<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L35\" rel=\"file-cortex_hardfault_handler-c-L35\">35<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L36\" rel=\"file-cortex_hardfault_handler-c-L36\">36<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L37\" rel=\"file-cortex_hardfault_handler-c-L37\">37<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L38\" rel=\"file-cortex_hardfault_handler-c-L38\">38<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L39\" rel=\"file-cortex_hardfault_handler-c-L39\">39<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L40\" rel=\"file-cortex_hardfault_handler-c-L40\">40<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L41\" rel=\"file-cortex_hardfault_handler-c-L41\">41<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L42\" rel=\"file-cortex_hardfault_handler-c-L42\">42<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L43\" rel=\"file-cortex_hardfault_handler-c-L43\">43<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L44\" rel=\"file-cortex_hardfault_handler-c-L44\">44<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L45\" rel=\"file-cortex_hardfault_handler-c-L45\">45<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L46\" rel=\"file-cortex_hardfault_handler-c-L46\">46<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L47\" rel=\"file-cortex_hardfault_handler-c-L47\">47<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L48\" rel=\"file-cortex_hardfault_handler-c-L48\">48<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L49\" rel=\"file-cortex_hardfault_handler-c-L49\">49<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L50\" rel=\"file-cortex_hardfault_handler-c-L50\">50<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L51\" rel=\"file-cortex_hardfault_handler-c-L51\">51<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L52\" rel=\"file-cortex_hardfault_handler-c-L52\">52<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L53\" rel=\"file-cortex_hardfault_handler-c-L53\">53<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L54\" rel=\"file-cortex_hardfault_handler-c-L54\">54<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L55\" rel=\"file-cortex_hardfault_handler-c-L55\">55<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L56\" rel=\"file-cortex_hardfault_handler-c-L56\">56<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L57\" rel=\"file-cortex_hardfault_handler-c-L57\">57<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L58\" rel=\"file-cortex_hardfault_handler-c-L58\">58<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L59\" rel=\"file-cortex_hardfault_handler-c-L59\">59<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L60\" rel=\"file-cortex_hardfault_handler-c-L60\">60<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L61\" rel=\"file-cortex_hardfault_handler-c-L61\">61<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L62\" rel=\"file-cortex_hardfault_handler-c-L62\">62<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L63\" rel=\"file-cortex_hardfault_handler-c-L63\">63<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L64\" rel=\"file-cortex_hardfault_handler-c-L64\">64<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L65\" rel=\"file-cortex_hardfault_handler-c-L65\">65<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L66\" rel=\"file-cortex_hardfault_handler-c-L66\">66<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L67\" rel=\"file-cortex_hardfault_handler-c-L67\">67<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L68\" rel=\"file-cortex_hardfault_handler-c-L68\">68<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L69\" rel=\"file-cortex_hardfault_handler-c-L69\">69<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L70\" rel=\"file-cortex_hardfault_handler-c-L70\">70<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L71\" rel=\"file-cortex_hardfault_handler-c-L71\">71<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L72\" rel=\"file-cortex_hardfault_handler-c-L72\">72<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L73\" rel=\"file-cortex_hardfault_handler-c-L73\">73<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L74\" rel=\"file-cortex_hardfault_handler-c-L74\">74<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L75\" rel=\"file-cortex_hardfault_handler-c-L75\">75<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L76\" rel=\"file-cortex_hardfault_handler-c-L76\">76<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L77\" rel=\"file-cortex_hardfault_handler-c-L77\">77<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L78\" rel=\"file-cortex_hardfault_handler-c-L78\">78<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L79\" rel=\"file-cortex_hardfault_handler-c-L79\">79<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L80\" rel=\"file-cortex_hardfault_handler-c-L80\">80<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L81\" rel=\"file-cortex_hardfault_handler-c-L81\">81<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L82\" rel=\"file-cortex_hardfault_handler-c-L82\">82<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L83\" rel=\"file-cortex_hardfault_handler-c-L83\">83<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L84\" rel=\"file-cortex_hardfault_handler-c-L84\">84<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L85\" rel=\"file-cortex_hardfault_handler-c-L85\">85<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L86\" rel=\"file-cortex_hardfault_handler-c-L86\">86<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L87\" rel=\"file-cortex_hardfault_handler-c-L87\">87<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L88\" rel=\"file-cortex_hardfault_handler-c-L88\">88<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L89\" rel=\"file-cortex_hardfault_handler-c-L89\">89<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L90\" rel=\"file-cortex_hardfault_handler-c-L90\">90<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L91\" rel=\"file-cortex_hardfault_handler-c-L91\">91<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L92\" rel=\"file-cortex_hardfault_handler-c-L92\">92<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L93\" rel=\"file-cortex_hardfault_handler-c-L93\">93<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L94\" rel=\"file-cortex_hardfault_handler-c-L94\">94<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L95\" rel=\"file-cortex_hardfault_handler-c-L95\">95<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L96\" rel=\"file-cortex_hardfault_handler-c-L96\">96<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L97\" rel=\"file-cortex_hardfault_handler-c-L97\">97<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L98\" rel=\"file-cortex_hardfault_handler-c-L98\">98<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L99\" rel=\"file-cortex_hardfault_handler-c-L99\">99<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L100\" rel=\"file-cortex_hardfault_handler-c-L100\">100<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L101\" rel=\"file-cortex_hardfault_handler-c-L101\">101<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L102\" rel=\"file-cortex_hardfault_handler-c-L102\">102<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L103\" rel=\"file-cortex_hardfault_handler-c-L103\">103<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L104\" rel=\"file-cortex_hardfault_handler-c-L104\">104<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L105\" rel=\"file-cortex_hardfault_handler-c-L105\">105<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L106\" rel=\"file-cortex_hardfault_handler-c-L106\">106<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L107\" rel=\"file-cortex_hardfault_handler-c-L107\">107<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L108\" rel=\"file-cortex_hardfault_handler-c-L108\">108<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L109\" rel=\"file-cortex_hardfault_handler-c-L109\">109<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L110\" rel=\"file-cortex_hardfault_handler-c-L110\">110<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L111\" rel=\"file-cortex_hardfault_handler-c-L111\">111<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L112\" rel=\"file-cortex_hardfault_handler-c-L112\">112<\/span>\n            <span class=\"line-number\" id=\"file-cortex_hardfault_handler-c-L113\" rel=\"file-cortex_hardfault_handler-c-L113\">113<\/span>\n          <\/td>\n          <td class=\"line-data\">\n            <pre class=\"line-pre\"><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC1\"><span class=\"pl-c\">/*!<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC2\"><span class=\"pl-c\"> * \\file cortex_hardfault_handler.c<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC3\"><span class=\"pl-c\"> * \\brief The code below implements a mechanism to discover HARD_FAULT sorces in Cortex-M embedded applications.<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC4\"><span class=\"pl-c\"> * \\version mcufreaks.blogspot.com<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC5\"><span class=\"pl-c\"> */<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC6\">&nbsp;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC7\"><span class=\"pl-c\">/*!<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC8\"><span class=\"pl-c\"> * \\note The following declaration is mandatory to avoid compiler errors. \\n<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC9\"><span class=\"pl-c\"> * In the declaration below, we are assigning the assembler label __label_hardfaultGetContext__<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC10\"><span class=\"pl-c\"> * to the entry point of __hardfaultGetContext__ function<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC11\"><span class=\"pl-c\">  */<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC12\"><span class=\"pl-st\">void<\/span> <span class=\"pl-en\">hardfaultGetContext<\/span>(<span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span>* stackedContextPtr) asm(<span class=\"pl-s1\"><span class=\"pl-pds\">&quot;<\/span>label_hardfaultGetContext<span class=\"pl-pds\">&quot;<\/span><\/span>);	\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC13\">&nbsp;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC14\"><span class=\"pl-c\">/*!<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC15\"><span class=\"pl-c\"> *  \\fn void hardfaultGetContext(unsigned long* stackedContextPtr)<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC16\"><span class=\"pl-c\"> *  \\brief Copies system stacked context into function local variables. \\n<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC17\"><span class=\"pl-c\"> *  This function is called from asm-coded Interrupt Service Routine associated to HARD_FAULT exception<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC18\"><span class=\"pl-c\"> *  \\param stackedContextPtr : Address of stack containing stacked processor context.<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC19\"><span class=\"pl-c\"> */<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC20\"><span class=\"pl-st\">void<\/span> <span class=\"pl-en\">hardfaultGetContext<\/span>(<span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span>* stackedContextPtr)\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC21\">{\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC22\">	<span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> stacked_r0;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC23\">    <span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> stacked_r1;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC24\">    <span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> stacked_r2;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC25\">    <span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> stacked_r3;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC26\">    <span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> stacked_r12;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC27\">    <span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> stacked_lr;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC28\">    <span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> stacked_pc;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC29\">    <span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> stacked_psr;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC30\">    <span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> _CFSR;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC31\">    <span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> _HFSR;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC32\">    <span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> _DFSR;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC33\">    <span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> _AFSR;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC34\">    <span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> _BFAR;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC35\">    <span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> _MMAR;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC36\">	        \n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC37\">    stacked_r0  = stackedContextPtr[<span class=\"pl-c1\">0<\/span>];\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC38\">    stacked_r1  = stackedContextPtr[<span class=\"pl-c1\">1<\/span>];\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC39\">    stacked_r2  = stackedContextPtr[<span class=\"pl-c1\">2<\/span>];\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC40\">    stacked_r3  = stackedContextPtr[<span class=\"pl-c1\">3<\/span>];\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC41\">    stacked_r12 = stackedContextPtr[<span class=\"pl-c1\">4<\/span>];\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC42\">    stacked_lr  = stackedContextPtr[<span class=\"pl-c1\">5<\/span>];\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC43\">    stacked_pc  = stackedContextPtr[<span class=\"pl-c1\">6<\/span>];\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC44\">    stacked_psr = stackedContextPtr[<span class=\"pl-c1\">7<\/span>];\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC45\">&nbsp;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC46\">    <span class=\"pl-c\">// Configurable Fault Status Register<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC47\">    <span class=\"pl-c\">// Consists of MMSR, BFSR and UFSR<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC48\">    _CFSR = (*((<span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> *)(0xE000ED28))) ;   \n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC49\">                                                                                        \n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC50\">    <span class=\"pl-c\">// Hard Fault Status Register<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC51\">    _HFSR = (*((<span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> *)(0xE000ED2C))) ;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC52\">&nbsp;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC53\">    <span class=\"pl-c\">// Debug Fault Status Register<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC54\">    _DFSR = (*((<span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> *)(0xE000ED30))) ;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC55\">&nbsp;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC56\">    <span class=\"pl-c\">// Auxiliary Fault Status Register<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC57\">    _AFSR = (*((<span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> *)(0xE000ED3C))) ;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC58\">&nbsp;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC59\">    <span class=\"pl-c\">// Read the Fault Address Registers. These may not contain valid values.<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC60\">    <span class=\"pl-c\">// Check BFARVALID/MMARVALID to see if they are valid values<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC61\">    <span class=\"pl-c\">// MemManage Fault Address Register<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC62\">    _MMAR = (*((<span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> *)(0xE000ED34))) ;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC63\">    <span class=\"pl-c\">// Bus Fault Address Register<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC64\">    _BFAR = (*((<span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> *)(0xE000ED38))) ;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC65\">&nbsp;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC66\">    <span class=\"pl-s3\">__asm<\/span>(<span class=\"pl-s1\"><span class=\"pl-pds\">&quot;<\/span>BKPT #0<span class=\"pl-cce\">\\n<\/span><span class=\"pl-pds\">&quot;<\/span><\/span>) ; <span class=\"pl-c\">// Break into the debugger<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC67\">&nbsp;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC68\">	<span class=\"pl-c\">// The following code avoids compiler warning [-Wunused-but-set-variable]<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC69\">    stackedContextPtr[<span class=\"pl-c1\">0<\/span>] = stacked_r0;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC70\">    stackedContextPtr[<span class=\"pl-c1\">1<\/span>] = stacked_r1;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC71\">    stackedContextPtr[<span class=\"pl-c1\">2<\/span>] = stacked_r2;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC72\">    stackedContextPtr[<span class=\"pl-c1\">3<\/span>] = stacked_r3;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC73\">    stackedContextPtr[<span class=\"pl-c1\">4<\/span>] = stacked_r12;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC74\">    stackedContextPtr[<span class=\"pl-c1\">5<\/span>] = stacked_lr;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC75\">    stackedContextPtr[<span class=\"pl-c1\">6<\/span>] = stacked_pc;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC76\">    stackedContextPtr[<span class=\"pl-c1\">7<\/span>] = stacked_psr;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC77\">    (*((<span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> *)(0xE000ED28))) = _CFSR;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC78\">    (*((<span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> *)(0xE000ED2C))) = _HFSR;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC79\">    (*((<span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> *)(0xE000ED30))) = _DFSR;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC80\">    (*((<span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> *)(0xE000ED3C))) = _AFSR;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC81\">    (*((<span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> *)(0xE000ED34))) = _MMAR;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC82\">    (*((<span class=\"pl-s\">volatile<\/span> <span class=\"pl-st\">unsigned<\/span> <span class=\"pl-st\">long<\/span> *)(0xE000ED38))) = _BFAR;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC83\">}\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC84\">&nbsp;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC85\"><span class=\"pl-c\">/*!<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC86\"><span class=\"pl-c\"> *  \\fn void hardfaultHandler(void)<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC87\"><span class=\"pl-c\"> *  \\brief HARD_FAULT interrupt service routine. Selects among PSP or MSP stacks and \\n<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC88\"><span class=\"pl-c\"> *  calls \\ref hardfaultGetContext passing the selected stack pointer address as parameter.<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC89\"><span class=\"pl-c\"> *  \\note __naked__ attribute avoids generating prologue and epilogue code sequences generated \\n<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC90\"><span class=\"pl-c\"> *  for C-functions, and only pure asm instructions should be included into the function body.<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC91\"><span class=\"pl-c\"> */<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC92\"><span class=\"pl-st\">void<\/span> <span class=\"pl-en\">__attribute__<\/span>((naked, interrupt)) hardfaultHandler(<span class=\"pl-st\">void<\/span>)\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC93\">{\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC94\">	<span class=\"pl-st\">__asm__<\/span> <span class=\"pl-vo\">volatile<\/span>	(\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC95\"><span class=\"pl-s1\"><span class=\"pl-pds\">&quot;<\/span> 		MOVS   R0, #4							<span class=\"pl-cce\">\\n<\/span><span class=\"pl-pds\">&quot;<\/span><\/span> <span class=\"pl-c\">/* Determine if processor uses PSP or MSP by checking bit.4 at LR register.		*/<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC96\"><span class=\"pl-s1\"><span class=\"pl-pds\">&quot;<\/span>		MOV    R1, LR							<span class=\"pl-cce\">\\n<\/span><span class=\"pl-pds\">&quot;<\/span><\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC97\"><span class=\"pl-s1\"><span class=\"pl-pds\">&quot;<\/span>		TST    R0, R1							<span class=\"pl-cce\">\\n<\/span><span class=\"pl-pds\">&quot;<\/span><\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC98\"><span class=\"pl-s1\"><span class=\"pl-pds\">&quot;<\/span>		BEQ    _IS_MSP							<span class=\"pl-cce\">\\n<\/span><span class=\"pl-pds\">&quot;<\/span><\/span> <span class=\"pl-c\">/* Jump to &#39;_MSP&#39; if processor uses MSP stack.									*/<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC99\"><span class=\"pl-s1\"><span class=\"pl-pds\">&quot;<\/span>		MRS    R0, PSP							<span class=\"pl-cce\">\\n<\/span><span class=\"pl-pds\">&quot;<\/span><\/span> <span class=\"pl-c\">/* Prepare PSP content as parameter to the calling function below.				*/<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC100\"><span class=\"pl-s1\"><span class=\"pl-pds\">&quot;<\/span>		BL	   label_hardfaultGetContext		<span class=\"pl-cce\">\\n<\/span><span class=\"pl-pds\">&quot;<\/span><\/span> <span class=\"pl-c\">/* Call &#39;hardfaultGetContext&#39; passing PSP content as stackedContextPtr value.	*/<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC101\"><span class=\"pl-s1\"><span class=\"pl-pds\">&quot;<\/span>_IS_MSP:										<span class=\"pl-cce\">\\n<\/span><span class=\"pl-pds\">&quot;<\/span><\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC102\"><span class=\"pl-s1\"><span class=\"pl-pds\">&quot;<\/span>		MRS    R0, MSP							<span class=\"pl-cce\">\\n<\/span><span class=\"pl-pds\">&quot;<\/span><\/span> <span class=\"pl-c\">/* Prepare MSP content as parameter to the calling function below.				*/<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC103\"><span class=\"pl-s1\"><span class=\"pl-pds\">&quot;<\/span>		BL	   label_hardfaultGetContext		<span class=\"pl-cce\">\\n<\/span><span class=\"pl-pds\">&quot;<\/span><\/span> <span class=\"pl-c\">/* Call &#39;hardfaultGetContext&#39; passing MSP content as stackedContextPtr value.	*/<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC104\">	::	);\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC105\">}\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC106\">&nbsp;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC107\">&nbsp;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC108\"><span class=\"pl-c\">//Uhhg...well... this is a dummy main function to test handler functionality<\/span>\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC109\"><span class=\"pl-st\">int<\/span> <span class=\"pl-en\">main<\/span>()\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC110\">{\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC111\">	<span class=\"pl-s3\">hardfaultHandler<\/span>();\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC112\">	<span class=\"pl-k\">return<\/span> <span class=\"pl-c1\">0<\/span>;\n<\/div><div class=\"line\" id=\"file-cortex_hardfault_handler-c-LC113\">}\n<\/div><\/pre>\n          <\/td>\n        <\/tr>\n      <\/table>\n    <\/div>\n\n          <\/div>\n          <div class=\"gist-meta\">\n            <a href=\"https://gist.github.com/mcufreaks/5200199/raw/cortex_hardfault_handler.c\" style=\"float:right\">view raw<\/a>\n            <a href=\"https://gist.github.com/mcufreaks/5200199#file-cortex_hardfault_handler-c\">cortex_hardfault_handler.c<\/a>\n            hosted with &#10084; by <a href=\"https://github.com\">GitHub<\/a>\n          <\/div>\n        <\/div>\n<\/div>\n')
